// Generated by CoffeeScript 1.3.3
(function() {

  define(['jquery', 'backbone', 'marionette', 'app/models', 'app/views', 'exports', 'i18n!app/nls/strings'], function(jQuery, Backbone, Marionette, Models, Views, exports, __) {
    var ContentRouter, mainController, mainRegion;
    mainRegion = new Marionette.Region({
      el: '#main'
    });
    mainController = {
      start: function() {
        return Backbone.history.start();
      },
      workspace: function() {
        var view, workspace;
        workspace = new Models.Workspace();
        workspace.fetch();
        view = new Views.WorkspaceView({
          collection: workspace
        });
        mainRegion.show(view);
        Backbone.history.navigate('');
        return workspace.on('change', function() {
          return view.render();
        });
      },
      createContent: function() {
        var content;
        content = new Models.Content();
        this._editContent(content);
        return Backbone.history.navigate('content');
      },
      editContent: function(id) {
        var content;
        content = new Models.Content();
        content.set('id', id);
        content.fetch();
        this._editContent(content);
        return Backbone.history.navigate("content/" + id);
      },
      _editContent: function(content) {
        var view;
        jQuery('#metadata-link').off('click');
        jQuery('#roles-link').off('click');
        jQuery('#metadata-link').on('click', function(evt) {
          var modal, view;
          view = new Views.MetadataEditView({
            model: content
          });
          modal = new Views.ModalWrapper(view, __('Edit Metadata'));
          return modal.show();
        });
        jQuery('#roles-link').on('click', function(evt) {
          var modal, view;
          view = new Views.RolesEditView({
            model: content
          });
          modal = new Views.ModalWrapper(view, __('Edit Roles'));
          return modal.show();
        });
        view = new Views.ContentEditView({
          model: content
        });
        return mainRegion.show(view);
      }
    };
    ContentRouter = Marionette.AppRouter.extend({
      controller: mainController,
      appRoutes: {
        '': 'workspace',
        'content': 'createContent',
        'content/:id': 'editContent'
      }
    });
    new ContentRouter();
    return jQuery.extend(exports, mainController);
  });

}).call(this);
