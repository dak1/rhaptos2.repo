{% set wysiwhaturl = "http://wysiwhat.github.com/Aloha-Editor/" %}
<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <!--[if IE]>
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <![endif]-->
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">

    <link rel="stylesheet" href="/static/bootstrap.css">
    <link rel="stylesheet" href="{{ wysiwhaturl }}src/css/jquery-ui/jquery.ui.all.css"
          type="text/css" />    
    <link rel="stylesheet" href="{{ wysiwhaturl }}src/css/aloha.css"
          type="text/css">
    <link rel="stylesheet" href="/static/css/custom.css"
          type="text/css" />

    <script src="https://login.persona.org/include.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.js"></script> 
    <script src="{{ wysiwhaturl }}src/lib/require.js"></script> 
    <script src="{{ wysiwhaturl }}src/lib/aloha.js" data-aloha-plugins="extra/toolbar,common/ui,common/format,common/paste,common/block,common/list,common/table,extra/draganddropfiles,common/image,extra/figure,extra/ribbon,extra/no-floating"></script>

    <script language="javascript">

function phil_aloha_start(){
      Aloha = window.Aloha || {};

      Aloha.settings = {
      logLevels: {'error': true, 'warn': true, 'info': false, 'debug': false},
      errorhandling : true,

      plugins: {
        // This whole thing is what's needed to:
        // - set a custom URL to send files to
        // - register a callback that updates the IMG with the new src
        draganddropfiles: {
          upload: {
            config: {
              method: "POST",
              url: "",
              callback: function(resp) {
                // If the response is a URL then change the Image source to it
                // The URL could be absolute (/^http/) or relative (/\// or [a-z])
                if (resp.match(/^http/) || resp.match(/^\//) || resp.match(/^[a-z]/) ) {
                } else {
                  alert('You dropped a file and we sent a message to the server to do something with it.\nIt responded with some gibberish so we are showing you some other file to show it worked');
                  resp = "{{ wysiwhaturl }}/src/test/AlohaEditorLogo.png";
                }

               $('#' + this.id).attr('src', resp);
//               Aloha.jQuery('#' + this.id).attr('src', resp);
                console.log('Updated Image src as a result of upload');
              }
            }
          }
        },
      block: {
      defaults : {
      '.default-block': {
      },
      'figure': {
      'aloha-block-type': 'EditableImageBlock'
      },
      }
      }
      },
      bundles: {
      // Path for custom bundle relative from require.js path
      user: '../demo/block'
      }
      };
}
      </script>




   


<script type="text/javascript" src="http://{{confd['rhaptos2repo_www_server_name']}}/static/bootstrap.js"></script>
<script type="text/javascript" src="http://{{confd['rhaptos2repo_www_server_name']}}/static/mustache.js"></script>
<!-- Frozone client -->
<script type="text/javascript" src="http://{{ confd['rhaptos2repo_www_server_name'] }}/static/conf.js"></script>
<script type="text/javascript" src="http://{{ confd['rhaptos2repo_www_server_name'] }}/static/authortools_client_templates.js"></script>
<script type="text/javascript" src="http://{{ confd['rhaptos2repo_www_server_name'] }}/static/authortools_client_tools.js"></script>
<script type="text/javascript" src="http://{{ confd['rhaptos2repo_www_server_name'] }}/static/authortools_client.js"></script>


    <script type="text/javascript">
      /* To be simple means to get current logged in USer back to JQuery*/
      var whoami = {
          userID      : "{{ g.user.userID }}",
          {% if g.user == None %}authenticated_identifier: null,{% else %}authenticated_identifier: "{{ g.user.authenticated_identifier }}", {% endif %}
          email       : "{{ g.user.email }}",
          name        : "{{ g.user.name }}"
      }
    </script>


    </head>

{% block body %}
     <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an outdated
        browser. <a href="http://browsehappy.com/">Upgrade your
        browser today</a>
        or <a href="http://www.google.com/chromeframe/?redirect=true">install
        Google Chrome Frame</a> to better experience this site.</p>
        <![endif]-->

      <!-- Main hero unit  -->

<div class="navbar navbar-fixed-top">
  <div class="navbar-inner">
    <div class="container">

	<ul class="nav">
	  <li class="active">
	    <a class="brand" href="#">ConneXions</a>
	  </li>
	  <li><a href="#">About</a></li>
	  <li><a href="#">MyCNX</a></li>

          <li class="dropdown">
           <a href="#"
              class="dropdown-toggle"
              data-toggle="dropdown">
              Tools
              <b class="caret"></b>
           </a>
           <ul class="dropdown-menu">
             <li>
               <a tabindex="-1" href="#import-modal"
                  id="import-link"
                  data-toggle="modal">Import</a>
             </li>
             <li><a tabindex="-1" href="#">Preview ...</a></li>
             <li>
               <a tabindex="-1" href="#publish-modal"
                  id="publish-link"
                  data-toggle="modal">Publish</a>
             </li>
             <li>
               <a tabindex="-1" href="#sharing-modal"
                  id="sharing-link"
                  data-toggle="modal">Sharing and Access
                  Management</a>
             </li>
             <li>
               <a tabindex="-1" href="#metadata-modal"
                  id="metadata-link"
                  data-toggle="modal">Metadata</a>
             </li>
           </ul>
          </li>



<li>
  {% if g.user %}
   <a href="{{ url_for('logout') }}">sign out [{{ g.user.name }}]</a>
  {% else %}
  <a href="{{ url_for('login') }}">sign in</a>
  {% endif %}
</li>
</ul>

<ul class="nav pull-right"> 

<li>  
  <div> {{ confd['bamboo_trackid'] }} <!-- test --> </div>
</li>

<li>
   <div id="usernamedisplay">fff</div>
</li>
	</ul>




    </div>
  </div>
</div> 


<div class="container-fluid">
 <div class="row-fluid">

  <!-- Main content -->
  <div class="span9" id="editorspan">


        <h1>{% block modname %}{% endblock %}</h1>
        {% block editor %}{% endblock %}



  </div>
  <!-- Collection Editor -->   
  <div class="span3" id="collectionspan">

     <div id="workspaces">   </div>
 
  </div>
 </div> 

 
            <footer>
      copyright &copy; 2012 connexions | 
     <a href="http://www.dcarter.co.uk">
       design by dcarter</a>
            </footer>

        </div> <!-- /container -->


  <!-- Modal structures -->
  <div class="modal hide fade in" id="metadata-modal">
    <form name="metadata-form" action="metadata" method="POST">
      <div class="modal-header">
        <button type="button" class="close"
                data-dismiss="modal" aria-hidden="true">×</button>
        <h3 id="modal-header-label">Edit Metadata</h3>
      </div>
      <div class="modal-body">
      </div>
      <div class="modal-footer">
        <button type="submit" class="btn btn-primary">Save</button>
        <button type="button" class="btn" data-dismiss="modal">Cancel</button>
      </div>
    </form>
  </div>

  <div class="modal hide fade in" id="import-modal">
    <form name="import-form" action="import" method="POST">
      <div class="modal-header">
        <button type="button" class="close"
                data-dismiss="modal" aria-hidden="true">×</button>
        <h3 id="modal-header-label">Import</h3>
      </div>
      <div class="modal-body">
      </div>
      <div class="modal-footer">
        <button type="submit" class="btn btn-primary">Import</button>
        <button type="button" class="btn" data-dismiss="modal">Cancel</button>
      </div>
    </form>
  </div>

  <div class="modal hide fade in" id="sharing-modal">
    <form name="sharing-form" action="sharing" method="POST">
      <div class="modal-header">
        <button type="button" class="close"
                data-dismiss="modal" aria-hidden="true">×</button>
        <h3 id="modal-header-label">Sharing</h3>
      </div>
      <div class="modal-body">

      </div>
      <div class="modal-footer">
        <button type="submit" class="btn btn-primary">Save</button>
        <button type="button" class="btn" data-dismiss="modal">Cancel</button>
      </div>
    </form>
  </div>

  <div class="modal hide fade in" id="publish-modal">
    <form name="publish-form" action="publish" method="POST">
      <div class="modal-header">
        <button type="button" class="close"
                data-dismiss="modal" aria-hidden="true">×</button>
        <h3 id="modal-header-label">Publish</h3>
      </div>
      <div class="modal-body">

      </div>
      <div class="modal-footer">
        <button type="submit" class="btn btn-primary">Publish</button>
        <button type="button" class="btn" data-dismiss="modal">Cancel</button>
      </div>
    </form>
  </div>

     </body>

{% endblock %}
